<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Test - Simple Check</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #17a2b8;
        }
        .success { border-left-color: #28a745; background: rgba(40, 167, 69, 0.2); }
        .error { border-left-color: #dc3545; background: rgba(220, 53, 69, 0.2); }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #218838; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Quick Login Check</h1>
        <p>This will check if you're logged in and test the same detection logic used by Forest Drive.</p>
        
        <div id="login-check" class="status">
            <h3>Checking login status...</h3>
        </div>

        <div class="status">
            <h3>Actions</h3>
            <button onclick="checkLogin()">üîÑ Check Login Status</button>
            <button onclick="simulateForestCheck()">üå≤ Test Forest Drive Logic</button>
            <button class="btn-danger" onclick="clearAll()">üóëÔ∏è Clear All Data</button>
            <button onclick="showRawData()">üìã Show Raw Data</button>
        </div>

        <div id="detailed-check" class="status" style="display: none;">
            <h3>Detailed Analysis</h3>
            <div id="detailed-content"></div>
        </div>

        <div id="raw-data" style="display: none;">
            <h3>Raw localStorage Data</h3>
            <pre id="raw-content"></pre>
        </div>

        <div class="status">
            <h3>Quick Navigation</h3>
            <button onclick="goToLogin()">üîë Login Page</button>
            <button onclick="goToDashboard()">üìä Dashboard</button>
            <button onclick="goToForest()">üå≤ Forest Drive</button>
        </div>
    </div>

    <script>
        // Replicate the exact logic from Forest Drive UIManager
        function checkUserLoginStatus() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            console.log('Token:', token ? 'Present' : 'Missing');
            console.log('User:', user ? 'Present' : 'Missing');
            
            // More thorough check (same as UIManager)
            if (token && user) {
                try {
                    const userData = JSON.parse(user);
                    if (userData && (userData.username || userData.email)) {
                        return { success: true, userData, token, method: 'Full Login' };
                    }
                } catch (e) {
                    console.warn('Invalid user data in localStorage:', e);
                    return { success: false, error: 'Invalid user data format', token, user };
                }
            }
            
            // Fallback check - just token
            const hasToken = !!token;
            return { 
                success: hasToken, 
                token, 
                user,
                userData: null,
                method: hasToken ? 'Token Only' : 'No Login',
                error: !token ? 'No token found' : !user ? 'No user data found' : 'Unknown error'
            };
        }

        function getCurrentUser() {
            try {
                const userStr = localStorage.getItem('user');
                if (userStr) {
                    return JSON.parse(userStr);
                }
            } catch (e) {
                console.warn('Could not parse user data:', e);
            }
            return null;
        }

        function checkLogin() {
            const result = checkUserLoginStatus();
            const checkDiv = document.getElementById('login-check');
            
            if (result.success) {
                checkDiv.className = 'status success';
                checkDiv.innerHTML = `
                    <h3>‚úÖ LOGIN SUCCESSFUL</h3>
                    <p><strong>Method:</strong> ${result.method}</p>
                    <p><strong>User:</strong> ${result.userData?.username || result.userData?.fullName || 'Unknown'}</p>
                    <p><strong>Email:</strong> ${result.userData?.email || 'Not provided'}</p>
                    <p><strong>Token:</strong> ${result.token ? result.token.substring(0, 20) + '...' : 'None'}</p>
                `;
            } else {
                checkDiv.className = 'status error';
                checkDiv.innerHTML = `
                    <h3>‚ùå LOGIN FAILED</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                    <p><strong>Token Present:</strong> ${result.token ? 'Yes' : 'No'}</p>
                    <p><strong>User Data Present:</strong> ${result.user ? 'Yes' : 'No'}</p>
                    <p><strong>Suggestion:</strong> Try logging in through the dashboard first.</p>
                `;
            }
        }

        function simulateForestCheck() {
            // This simulates exactly what Forest Drive UIManager does
            const isUserLoggedIn = checkUserLoginStatus().success;
            const currentUser = getCurrentUser();
            const resumeId = localStorage.getItem('editResumeId') || localStorage.getItem('previewResumeId');
            
            const detailedDiv = document.getElementById('detailed-check');
            const contentDiv = document.getElementById('detailed-content');
            
            detailedDiv.style.display = 'block';
            contentDiv.innerHTML = `
                <h4>üå≤ Forest Drive Detection Results:</h4>
                <p><strong>isUserLoggedIn:</strong> ${isUserLoggedIn ? '‚úÖ TRUE' : '‚ùå FALSE'}</p>
                <p><strong>currentUser:</strong> ${currentUser ? JSON.stringify(currentUser, null, 2) : 'null'}</p>
                <p><strong>resumeId:</strong> ${resumeId || 'Not set'}</p>
                <p><strong>Edit Button Status:</strong> ${isUserLoggedIn ? 'üü¢ ENABLED' : 'üî¥ DISABLED'}</p>
                <hr>
                <p><strong>What Forest Drive will show:</strong></p>
                <p>${isUserLoggedIn ? 
                    `‚úÖ "Logged in as ${currentUser?.username || currentUser?.fullName || 'User'}"` : 
                    '‚ùå "Not Logged In"'
                }</p>
            `;
        }

        function showRawData() {
            const rawDiv = document.getElementById('raw-data');
            const contentDiv = document.getElementById('raw-content');
            
            const allData = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                allData[key] = localStorage.getItem(key);
            }
            
            rawDiv.style.display = rawDiv.style.display === 'none' ? 'block' : 'none';
            contentDiv.textContent = JSON.stringify(allData, null, 2);
        }

        function clearAll() {
            if (confirm('This will clear ALL localStorage data including login. Continue?')) {
                localStorage.clear();
                location.reload();
            }
        }

        function goToLogin() {
            window.open('file:///F:/Interavtive_Resume/Interactive-Resume-Maker/FrontEnd/Login/Login_Page.html', '_blank');
        }

        function goToDashboard() {
            window.open('file:///F:/Interavtive_Resume/Interactive-Resume-Maker/FrontEnd/Login/dashboard.html', '_blank');
        }

        function goToForest() {
            // Set the forest drive mode first
            localStorage.setItem('forestDriveMode', 'edit');
            window.open('http://localhost:3000', '_blank');
        }

        // Auto-check on page load
        setTimeout(checkLogin, 500);
    </script>
</body>
</html>
