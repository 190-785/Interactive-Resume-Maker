<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Debug - Forest Drive</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .debug-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #17a2b8;
        }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        .warning { border-left-color: #ffc107; }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #218838; }
        .btn-clear { background: #dc3545; }
        .btn-clear:hover { background: #c82333; }
        .btn-test { background: #17a2b8; }
        .btn-test:hover { background: #138496; }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Login Status Debug Tool</h1>
        <p>This tool helps diagnose login detection issues in the Forest Drive 3D scene.</p>

        <div class="debug-item">
            <h3>Current Login Status</h3>
            <div id="login-status">Checking...</div>
        </div>

        <div class="debug-item">
            <h3>LocalStorage Contents</h3>
            <div id="storage-contents">Loading...</div>
        </div>

        <div class="debug-item">
            <h3>Forest Drive Mode</h3>
            <div id="forest-mode">Checking...</div>
        </div>

        <div class="debug-item">
            <h3>Actions</h3>
            <button onclick="refreshStatus()">üîÑ Refresh Status</button>
            <button class="btn-test" onclick="testLogin()">üß™ Test Login Detection</button>
            <button class="btn-clear" onclick="clearStorage()">üóëÔ∏è Clear Storage</button>
            <button onclick="simulateLogin()">üë§ Simulate Login</button>
        </div>

        <div class="debug-item">
            <h3>Navigation</h3>
            <button onclick="window.open('file:///F:/Interavtive_Resume/Interactive-Resume-Maker/FrontEnd/Login/dashboard.html', '_blank')">
                üìä Open Dashboard
            </button>
            <button onclick="window.open('http://localhost:3000', '_blank')">
                üå≤ Open Forest Drive
            </button>
            <button onclick="window.open('file:///F:/Interavtive_Resume/Interactive-Resume-Maker/FrontEnd/Login/Login_Page.html', '_blank')">
                üîë Login Page
            </button>
        </div>

        <div class="debug-item">
            <h3>Raw Data</h3>
            <pre id="raw-data">Loading...</pre>
        </div>
    </div>

    <script>
        function checkLoginStatus() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            const forestMode = localStorage.getItem('forestDriveMode');
            const editResumeId = localStorage.getItem('editResumeId');
            const previewResumeId = localStorage.getItem('previewResumeId');

            let userData = null;
            try {
                if (user) {
                    userData = JSON.parse(user);
                }
            } catch (e) {
                console.error('Error parsing user data:', e);
            }

            return {
                hasToken: !!token,
                token: token ? token.substring(0, 20) + '...' : null,
                hasUser: !!user,
                userData: userData,
                forestMode: forestMode,
                editResumeId: editResumeId,
                previewResumeId: previewResumeId,
                isLoggedIn: !!(token && user),
                loginMethod: token && user ? 'Full Login' : token ? 'Token Only' : user ? 'User Only' : 'Not Logged In'
            };
        }

        function refreshStatus() {
            const status = checkLoginStatus();
            
            // Update login status
            const loginDiv = document.getElementById('login-status');
            if (status.isLoggedIn) {
                loginDiv.innerHTML = `
                    <div style="color: #28a745;">
                        ‚úÖ <strong>LOGGED IN</strong><br>
                        Method: ${status.loginMethod}<br>
                        User: ${status.userData?.username || status.userData?.fullName || 'Unknown'}
                    </div>
                `;
                loginDiv.parentElement.className = 'debug-item success';
            } else {
                loginDiv.innerHTML = `
                    <div style="color: #dc3545;">
                        ‚ùå <strong>NOT LOGGED IN</strong><br>
                        Issue: ${!status.hasToken ? 'No token' : !status.hasUser ? 'No user data' : 'Unknown'}
                    </div>
                `;
                loginDiv.parentElement.className = 'debug-item error';
            }

            // Update storage contents
            const storageDiv = document.getElementById('storage-contents');
            const keys = Object.keys(localStorage).filter(key => 
                key.includes('token') || key.includes('user') || key.includes('forest') || key.includes('resume')
            );
            
            if (keys.length > 0) {
                storageDiv.innerHTML = keys.map(key => 
                    `<strong>${key}:</strong> ${localStorage.getItem(key)?.substring(0, 50)}${localStorage.getItem(key)?.length > 50 ? '...' : ''}`
                ).join('<br>');
            } else {
                storageDiv.innerHTML = '<em>No relevant localStorage items found</em>';
            }

            // Update forest mode
            const modeDiv = document.getElementById('forest-mode');
            if (status.forestMode) {
                modeDiv.innerHTML = `Mode: <strong>${status.forestMode}</strong>`;
                if (status.editResumeId) modeDiv.innerHTML += `<br>Edit Resume ID: ${status.editResumeId}`;
                if (status.previewResumeId) modeDiv.innerHTML += `<br>Preview Resume ID: ${status.previewResumeId}`;
            } else {
                modeDiv.innerHTML = '<em>No forest drive mode set</em>';
            }

            // Update raw data
            const rawDiv = document.getElementById('raw-data');
            rawDiv.textContent = JSON.stringify(status, null, 2);
        }

        function testLogin() {
            const status = checkLoginStatus();
            
            if (status.isLoggedIn) {
                alert(`‚úÖ Login detection SUCCESS!\n\nUser: ${status.userData?.username || 'Unknown'}\nToken: ${status.token}\nMethod: ${status.loginMethod}`);
            } else {
                alert(`‚ùå Login detection FAILED!\n\nToken: ${status.hasToken ? 'Present' : 'Missing'}\nUser Data: ${status.hasUser ? 'Present' : 'Missing'}\n\nPlease log in through the dashboard first.`);
            }
        }

        function clearStorage() {
            if (confirm('Clear all login data? This will log you out.')) {
                const keys = ['token', 'user', 'forestDriveMode', 'editResumeId', 'previewResumeId'];
                keys.forEach(key => localStorage.removeItem(key));
                refreshStatus();
                alert('Storage cleared! You are now logged out.');
            }
        }

        function simulateLogin() {
            const mockToken = 'mock-jwt-token-' + Date.now();
            const mockUser = {
                username: 'testuser',
                fullName: 'Test User',
                email: 'test@example.com'
            };
            
            localStorage.setItem('token', mockToken);
            localStorage.setItem('user', JSON.stringify(mockUser));
            localStorage.setItem('forestDriveMode', 'edit');
            
            refreshStatus();
            alert('Mock login simulated! Now test the Forest Drive.');
        }

        // Initialize on page load
        refreshStatus();
        
        // Auto-refresh every 10 seconds
        setInterval(refreshStatus, 10000);
    </script>
</body>
</html>
